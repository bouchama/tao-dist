{"version":3,"sources":["routes.js","history/line!tpl","history/index.js"],"names":["define","History","actions","index","hb","template","Handlebars","depth0","helpers","partials","data","this","compilerInfo","merge","stack1","helper","options","buffer","escapeExpression","helperMissing","id","call","hash","modified","author","message","__","$","lineTpl","feedback","_restoreRevision","element","$table","body","find","$this","revision","val","prompt","post","_url","revisionId","done","res","success","append","trigger","error","start","$container","$form","$submiter","on","e","preventDefault","stopImmediatePropagation","$message","addClass","attr","serialize","commitMessage","complete","removeClass","event"],"mappings":"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","file":"routes.js","sourcesContent":["define('taoRevision/controller/routes',[],function(){\n    return {\n        'History' : {\n            'actions' : {\n                'index' : 'controller/history/index',\n            }\n        }\n    };\n});\n\n","\ndefine('tpl!taoRevision/controller/history/line', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;\n\n\n  buffer += \"<tr>\\n    <td class=\\\"numeric\\\">\";\n  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</td>\\n    <td class=\\\"date\\\">\";\n  if (helper = helpers.modified) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.modified); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</td>\\n    <td class=\\\"user\\\">\";\n  if (helper = helpers.author) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.author); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"</td>\\n    <td class=\\\"message\\\">\";\n  if (helper = helpers.message) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.message); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</td>\\n    <td class=\\\"actions\\\">\\n        <button class=\\\"btn-info small restore_revision\\\" data-revision=\\\"\";\n  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\n            <span class=\\\"icon-undo\\\"></span>\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Restore\", options) : helperMissing.call(depth0, \"__\", \"Restore\", options)))\n    + \"\\n        </button>\\n    </td>\\n</tr>\\n\";\n  return buffer;\n  });\n});\n\n","define('taoRevision/controller/history/index',[\n    'jquery',\n    'i18n',\n    'tpl!taoRevision/controller/history/line',\n    'helpers',\n    'ui/feedback',\n    'select2',\n    'ui/tooltip'\n    ], function($, __, lineTpl, helpers, feedback){\n        'use strict';\n\n        /**\n         * Restore a revision\n         * @param  {DOM Element} element DOM element that triggered the function\n         */\n        var _restoreRevision = function(element) {\n            var $table = $('#revisions-table'),\n                body = $table.find('tbody')[0];\n\n            //Get the revision id\n            var $this = $(element),\n                revision = $this.data('revision');\n            var id = $('#resource_id').val();\n\n            var message = prompt(\"Please enter a message\", __(\"Restored version %s\", revision));\n\n            if( typeof revision !== \"undefined\" &&\n                typeof message !== \"undefined\" &&\n                message != null &&\n                revision !== \"\" &&\n                message !== \"\"){\n                $.post(\n                    helpers._url('restoreRevision', 'History', 'taoRevision'),\n                    {id : id, revisionId : revision, message : message})\n                    .done(function(res){\n                        if(res && res.success){\n                            feedback().success(__(\"Resource restored\"));\n                            $(body).append(lineTpl(res));\n                            $('.tree').trigger('refresh.taotree'); \n                        } else {\n                            feedback().error(__(\"Something went wrong...\"));\n                        }\n                    })\n            }\n        };\n\n        var mainCtrl = {\n            'start' : function(){\n\n                var $container = $('.revision-container'),\n                    $form      = $('form', $container),\n                    $submiter  = $(':submit', $form);\n\n                var $table = $('#revisions-table'),\n                    body = $table.find('tbody')[0];\n\n                $form.on('submit', function(e){\n                    e.preventDefault();\n                    e.stopImmediatePropagation();\n                });\n                $submiter.on('click', function(e){\n                    e.preventDefault();\n\n                var $message = $('#message',$form);\n                if($message.val() !== \"\"){\n                    $submiter.addClass('disabled');\n                    $.post($form.attr('action'), $form.serialize())\n                        .done(function(res){\n                            if(res && res.success){\n                                feedback().success(res.commitMessage);\n                                $(body).append(lineTpl(res));\n\n\n                            } else {\n                                feedback().error(__(\"Something went wrong...\"));\n                            }\n                        })\n                        .complete(function(){\n                            $submiter.removeClass('disabled');\n                            $message.val('');\n                        });\n                }\n                else{\n                    feedback().error(__(\"Please give a message to your commit\"));\n                }\n                });\n\n\n                $table.on('click', '.restore_revision', function(event) {\n                    event.preventDefault();\n                    _restoreRevision(this);\n                });\n            }\n        };\n\n        return mainCtrl;\n    })\n;\n"]}